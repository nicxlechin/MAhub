<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MV MarTech Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: linear-gradient(to bottom right, #0f172a, #581c87, #0f172a);
            min-height: 100vh;
        }
        .typing-indicator span {
            animation: typing 1.4s infinite;
            animation-fill-mode: both;
        }
        .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }
        @keyframes typing {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }
        .chat-content a {
            color: #a78bfa;
            text-decoration: underline;
        }
        .chat-content a:hover {
            color: #c4b5fd;
        }
    </style>
</head>
<body class="text-white p-6">
    <div class="max-w-4xl mx-auto">
        <!-- Header -->
        <div class="mb-8 text-center">
            <h1 class="text-4xl font-bold mb-2 bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent">
                MV MarTech Hub
            </h1>
            <p class="text-slate-300">Ask anything about your marketing technology stack</p>
        </div>

        <!-- Chat Container -->
        <div id="chatContainer" class="space-y-4 mb-6">
            <!-- Welcome Message -->
            <div class="bg-slate-800/50 border border-slate-700 rounded-xl p-6">
                <div class="flex items-start gap-4">
                    <div class="w-10 h-10 bg-gradient-to-br from-purple-500 to-pink-500 rounded-full flex items-center justify-center flex-shrink-0">
                        <span class="text-lg">ðŸ¤–</span>
                    </div>
                    <div class="chat-content text-slate-300">
                        <p>Hi! I'm your MarTech assistant. I have access to your Airtable knowledge base and can help you with:</p>
                        <ul class="mt-2 text-slate-400 text-sm space-y-1">
                            <li>â€¢ MarTech tools and platforms</li>
                            <li>â€¢ Data flows and integrations</li>
                            <li>â€¢ Processes and documentation</li>
                            <li>â€¢ Any information stored in your Airtable</li>
                        </ul>
                        <p class="mt-3 text-slate-400 text-sm">Just ask me anything!</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Loading Indicator -->
        <div id="loading" class="hidden bg-slate-800/50 border border-slate-700 rounded-xl p-6 mb-6">
            <div class="flex items-center gap-4">
                <div class="w-10 h-10 bg-gradient-to-br from-purple-500 to-pink-500 rounded-full flex items-center justify-center flex-shrink-0">
                    <span class="text-lg">ðŸ¤–</span>
                </div>
                <div>
                    <div class="typing-indicator flex gap-1 mb-1">
                        <span class="w-2 h-2 bg-purple-400 rounded-full"></span>
                        <span class="w-2 h-2 bg-purple-400 rounded-full"></span>
                        <span class="w-2 h-2 bg-purple-400 rounded-full"></span>
                    </div>
                    <p class="text-xs text-slate-500">Searching knowledge base...</p>
                </div>
            </div>
        </div>

        <!-- Input Area -->
        <div class="sticky bottom-6">
            <div class="relative">
                <input type="text" id="questionInput"
                    placeholder="Ask a question..."
                    class="w-full px-6 py-4 bg-slate-800/80 border border-slate-600 rounded-xl text-white placeholder-slate-400 pr-24 backdrop-blur-sm"
                    onkeypress="if(event.key==='Enter')askQuestion()">
                <button onclick="askQuestion()"
                    class="absolute right-3 top-1/2 transform -translate-y-1/2 bg-purple-500 hover:bg-purple-600 px-5 py-2 rounded-lg font-medium transition-colors">
                    Ask
                </button>
            </div>

            <!-- Quick Questions -->
            <div class="mt-4 flex flex-wrap gap-2">
                <button onclick="askQuestion('What tools do we have?')" class="bg-slate-800/50 hover:bg-slate-700 border border-slate-700 rounded-full px-3 py-1.5 text-xs transition-colors">
                    What tools do we have?
                </button>
                <button onclick="askQuestion('What DNAs are there?')" class="bg-slate-800/50 hover:bg-slate-700 border border-slate-700 rounded-full px-3 py-1.5 text-xs transition-colors">
                    What DNAs are there?
                </button>
                <button onclick="askQuestion('How does data flow work?')" class="bg-slate-800/50 hover:bg-slate-700 border border-slate-700 rounded-full px-3 py-1.5 text-xs transition-colors">
                    How does data flow work?
                </button>
                <button onclick="askQuestion('Show me all integrations')" class="bg-slate-800/50 hover:bg-slate-700 border border-slate-700 rounded-full px-3 py-1.5 text-xs transition-colors">
                    Show integrations
                </button>
            </div>
        </div>
    </div>

    <script>
        const API_URL = window.location.hostname === 'localhost'
            ? 'http://localhost:3000/api/chat'
            : '/api/chat';

        async function askQuestion(presetQuestion) {
            const input = document.getElementById('questionInput');
            const question = presetQuestion || input.value.trim();

            if (!question) return;

            // Clear input
            input.value = '';

            // Add user message to chat
            addMessage('user', question);

            // Show loading
            document.getElementById('loading').classList.remove('hidden');

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ question })
                });

                const data = await response.json();

                // Hide loading
                document.getElementById('loading').classList.add('hidden');

                if (data.success && data.answer) {
                    addMessage('assistant', data.answer);
                } else {
                    addMessage('assistant', `Sorry, I encountered an error: ${data.error || 'Unknown error'}. Please try again.`);
                }

            } catch (error) {
                document.getElementById('loading').classList.add('hidden');
                addMessage('assistant', `Sorry, I couldn't connect to the server. Please check if the service is running.`);
            }
        }

        function addMessage(role, content) {
            const container = document.getElementById('chatContainer');
            const div = document.createElement('div');
            div.className = 'bg-slate-800/50 border border-slate-700 rounded-xl p-6';

            const isUser = role === 'user';
            const avatar = isUser ? 'ðŸ‘¤' : 'ðŸ¤–';
            const gradient = isUser ? 'from-slate-500 to-slate-600' : 'from-purple-500 to-pink-500';

            // Format content: convert markdown-style formatting to HTML
            let formattedContent = content
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                .replace(/\[(.*?)\]\((.*?)\)/g, '<a href="$2" target="_blank">$1</a>')
                .replace(/^â€¢ /gm, '&bull; ')
                .replace(/^- /gm, '&bull; ')
                .replace(/\n/g, '<br>');

            div.innerHTML = `
                <div class="flex items-start gap-4">
                    <div class="w-10 h-10 bg-gradient-to-br ${gradient} rounded-full flex items-center justify-center flex-shrink-0">
                        <span class="text-lg">${avatar}</span>
                    </div>
                    <div class="chat-content flex-1 text-slate-300 leading-relaxed">
                        ${formattedContent}
                    </div>
                </div>
            `;

            container.appendChild(div);
            div.scrollIntoView({ behavior: 'smooth', block: 'end' });
        }

        // Focus input on load
        document.getElementById('questionInput').focus();
    </script>
</body>
</html>
